# $Id$

test "VCL: test syntax/semantic checks on backend decls."

# Missing backend
varnish v1 -badvcl {
}

# Reference to non-existent backend
varnish v1 -badvcl {
	backend b1 {
		.host = "localhost";
	}
	sub vcl_recv {
		set req.backend = b2;
	}
}

# Missing .host
varnish v1 -badvcl {
	backend b1 {
		.port = "http";
	}
}

# Too many .host
varnish v1 -badvcl {
	backend b1 {
		.host = "foo";
		.host = "bar";
	}
}

# Too many .port
varnish v1 -badvcl {
	backend b1 {
		.host = "foo";
		.port = "http";
		.port = "https";
	}
}

# Too many .connect_timeout
varnish v1 -badvcl {
	backend b1 {
		.host = "foo";
		.connect_timeout = 1m;
		.connect_timeout = 1m;
	}
}

# Check backend reference by name
varnish v1 -badvcl {
	backend b1 { .host = "127.0.0.2"; }
	director r1 random {
		{ .weight = 1; .backend = b1; }
		{ .weight = 1; .backend = { .host = "127.0.0.3"; } }
		{ .weight = 1; .backend = 3745; }  // Brownie points for getting the joke
	}
}

# Check backend reference by name
varnish v1 -badvcl {
	backend b1 { .host = "127.0.0.2"; }
	backend b2 b1;
}

# Check backend reference by non-C-compat name
varnish v1 -badvcl {
	backend b-1 { .host = "127.0.0.2"; }
}

# Check backend reference by non-C-compat name
varnish v1 -badvcl {
	backend b1 { .host = "127.0.0.2"; }
	sub vcl_recv {
		set req.backend = b-1;
	}
}

# Old backend syntax

varnish v1 -badvcl {
	backend b1 {
		set host = "localhost";
	}
}
